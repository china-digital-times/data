{"id":255631,"link":"https://chinadigitaltimes.net/chinese/2012/10/编程随想-如何防止黑客入侵6：web相关的防范-中/","date":"2012-10-09T00:30:20Z","modified":"2012-10-09T22:34:53Z","title":"编程随想 | 如何防止黑客入侵6：Web相关的防范 (中)","content":"<p>　　在本系列的<a rel=\"nofollow\" href=\"http://program-think.blogspot.com/2012/08/howto-prevent-hacker-attack-5.html\">前一篇</a>聊了些基础性的东西，包括：常见的攻击手法、如何选择浏览器和插件。今天，俺继续介绍几个相对高级一点的话题。</p>\n<h2>★如何防范浏览器和插件的漏洞？</h2>\n<p>　　在前一篇已经告诉大伙儿&#8221;如何选择浏览器&#8221;。但是光知道这个是不够滴！因为浏览器也是软件，只要是软件就可能会出现漏洞（包括安全漏洞）。<br />　　即使你按照俺的建议，选择 Firefox 或 Chrome 作为日常的浏览器，也<b>无法完全避免</b>&#8220;浏览器自身出漏洞&#8221;的问题。而且浏览器的漏洞中，有一些是没有补丁的高危漏洞（包括&#8221;未公开漏洞&#8221;和&#8221;零日漏洞&#8221;，俺在<a rel=\"nofollow\" href=\"http://program-think.blogspot.com/2010/08/howto-prevent-hacker-attack-4.html\">前面的帖子</a>里介绍过）。因为没有补丁，所以这类高危漏洞就特别危险。这就引出了<b>第一个问题：如何防范浏览器的漏洞？</b><br />　　另外，在浏览器插件中，Flash 插件既是最危险的插件，也是使用最广的插件。<b>这就引出了第二个问题，如何安全地使用危险的插件？</b><br />　　要解决上述2个问题，可以使用同一个原则，那就是：<b>对浏览器进行隔离</b>。具体的隔离方式有很多种，今天俺由浅入深，分别介绍一下。</p>\n<h2>★&#8221;多浏览器&#8221;的方案</h2>\n<p></p>\n<h3>◇操作步骤</h3>\n<p>　　这招是最简单的——就是在一台电脑上安装多款<b>不同内核</b>的浏览器。具体步骤俺就不多说了，节约点口水。</p>\n<h3>◇优点</h3>\n<p>　　<b>1. 解决网银的问题</b><br />　　前面提到了国内网银依赖于 IE 的问题。但是 IE 的安全性又不如 Firefox 和 Chrome，咋办捏？最简单的办法就是同时安装两款浏览器（比如 IE + Firefox）。平时你上网的时候，用 Firefox，需要用网银，则改用 IE。<br />　　由于你仅仅在使用网银的时候，才开启 IE，大大降低了 IE 被入侵的机会。</p>\n<p>　　<b>2. 解决跨站脚本（XSS）的问题</b><br />　　使用多种浏览器，还可以帮你解决跨站脚本攻击的问题。<br />　　单纯的XSS攻击，主要是依赖 JavaScript。而 JavaScript 只能在浏览器进程内起作用，无法跨浏览器进程。所以，如果你同时使用 A B 两款浏览器。如果 A 浏览器发送 XSS 攻击，通常不会影响到 B 浏览器。除非这个 XSS 攻击结合了浏览器漏洞或插件漏洞。那么，多款浏览器是否能防范浏览器漏洞和插件漏洞捏？请看往下看。</p>\n<p>　　<b>3. 部分解决高危插件（Flash）的使用问题</b><br />　　俺在<a rel=\"nofollow\" href=\"http://program-think.blogspot.com/2012/08/howto-prevent-hacker-attack-5.html\">上一篇</a>提到了利用 Flash 入侵 Gmail 的案例。<br />　　比方说，你同时用 Firefox 和 Chrome。其中 Firefox 安装 Flash，用来上普通的网站；而 Chrome <b>禁用</b> Flash，专门用来上 Google 的相关服务器（比如 Gmail）。<br />　　某天，你收到一封恶意的邮件，该邮件会利用 Flash 的漏洞来入侵用户的电脑。幸运的是，你用来访问 Gmail 的 Chrome 上没有 Flash 插件（被禁用），于是攻击者的阴谋没有得逞 :-)</p>\n<h3>◇缺点</h3>\n<p>　　<b>1. 无法彻底解决浏览器漏洞和插件漏洞的问题</b><br />　　细心的读者会注意到，刚才那个小节的标题是&#8221;部分解决高危插件（Flash）的问题&#8221;。为啥俺要特地强调&#8221;<b>部分解决</b>&#8220;捏？因为浏览器的漏洞和插件的漏洞有很多种。有些漏洞只是让浏览器崩溃，无伤大雅；而有些漏洞可以导致在本地执行代码，并且能进一步植入木马。一旦你碰到后者，即使你采用&#8221;多种浏览器&#8221;的方式，也抵挡不住。<br />　　某些天真的网友可能会问：浏览器厂商和插件厂商不是会升级补丁吗？但是问题在于，有少数一些漏洞是没有补丁的。为啥会这样捏？请看本系列上一篇《<a rel=\"nofollow\" href=\"http://program-think.blogspot.com/2010/08/howto-prevent-hacker-attack-4.html\">安全漏洞的基本防范</a>》，里面介绍了&#8221;未公开漏洞&#8221;和&#8221;零日漏洞&#8221;。<br />　　不过别担心，俺后面还会介绍更高级的招数，来防范这种情况。</p>\n<p>　　<b>2. 灵活性不够</b><br />　　对于&#8221;多浏览器&#8221;的方案，还有一个缺点是不够灵活。<br />　　因为你要为每一种用途安装一款浏览器，如果你的用途比较多（比如：上网银、普通浏览、上Gmail、看视频），就要装好几款。<br />　　另外，有些用户就喜欢某一款浏览器，你让这些用户装好几款浏览器，他们会觉得不爽。<br />　　对于&#8221;灵活性不够&#8221;的缺点，大伙儿可以参考接下来要介绍的第二招——&#8221;多实例&#8221;的方案。</p>\n<h2>★&#8221;多实例&#8221;的方案</h2>\n<p></p>\n<h3>◇什么是浏览器的多实例？</h3>\n<p>　　所谓的浏览器多实例，有时候也称之为 &#8220;Multiple Profiles&#8221;。<br />　　不论是 Firefox 还是 Chrome，默认安装的时候，只有一个实例（Profile）。和浏览器相关的各种信息，包括：插件、扩展、外观（皮肤）、页面缓存、cookie、等等，都存储在这个实例中。<br />　　反之，如果使用多实例，每个实例都具有独立的插件、独立的扩展、独立的外观（皮肤）、独立的页面缓存、独立的cookie、等等。不同实例之间是相对隔离的，不会互相影响。<br />　　对于 Chrome，再特别提醒一下：<br />　　Chrome 同时支持 &#8220;Multiple Profiles&#8221; 和 &#8220;Multiple Accounts&#8221;。但别把这两者搞混了。即使你配置了多个Accounts，依然在同一个实例里。</p>\n<h3>◇操作步骤</h3>\n<p>　　多实例的配置，很多人不晓得。所以俺详细说一下。考虑到 Windows 用户居多，俺以 Windows 举例。Linux 和 Mac OS 的操作步骤大同小异。</p>\n<p>　　<b>多实例的 Firefox</b></p>\n<p>　　对于 Windows 上的 Firefox，Profile 都放置于 %APPDATA%MozillaFirefoxProfiles 目录下。<br />　　假设你想创建一个<b>新的</b> Firefox 实例，专门用来访问你的 Web 邮箱。那你可以通过如下命令行来启动 Firefox。<br />&#8220;<u><b>PATH</b></u><u><b></b></u>firefox.exe&#8221; -P &#8220;<u><b>Mail</b></u>&#8221; -no-remote<br />　　上述命令中，<u><b>PATH</b></u> 表示你的 Firefox 的<b>安装目录</b>。Mail 表示你要创建的<b>实例名</b>（实例名可以是任意字母组合，你也可以换其它名称）。<br />　　运行完上述命令，Firefox 会启动出一个名叫 Mail 的实例。与此同时，在 %APPDATA%MozillaFirefoxProfiles 下会多出一个名叫 Mail 的目录。<br />　　按照上述方式依样画葫芦，你就可以启动出任意多个 Firefox 实例。为了省事，你可以把上述命令行做成一个快捷方式，放到桌面上，免得每次都敲键盘。<br />　　另外，Firefox 还提供了一个多实例的管理界面，用如下命令可以调出该界面。<br />&#8220;<u><b>PATH</b></u><u><b></b></u>firefox.exe&#8221; -p</p>\n<p>　　<b>多实例的 Chrome</b></p>\n<p>　　Chrome 类似于 Firefox，也可以通过命令行启动新的实例。<br />　　对于 Windows 上的 Chrome，由于 Chrome 安装的时候没让选安装目录，所以其<b>安装目录固定如下</b>：</p>\n<p>Windows 7 或 Vista  系统<br />C:SERS<u><b>USER</b></u>APPDATAocalgooglechromeapplicationchrome.exe<br />windows xp 系统<br />c:documents and settings<u><b>user</b></u>ocal settingsapplication datagooglechromeapplicationchrome.exe<br />　　上述的 <u><b>user</b></u> 表示你的 windows 用户名</p>\n<p>　　找到 chrome.exe 之后，接下来，你需要创建一个目录，用来存放新创建的实例。比方说，你用的是这个目录： <u><b>x:xxxx</b></u><br />　　然后，通过如下命令启动 chrome，就可以创建出新实例</p>\n<p>vista 或  windows 7 系统<br />c:SERS<u><b>USER</b></u>APPDATAocalgooglechromeapplicationchrome.exe &#8211;user-data-dir=&#8221;<u><b>x:xxxx</b></u>&#8220;<br />windows xp 或 win 2003 系统<br />c:documents and settings<u><b>user</b></u>ocal settingsapplication datagooglechromechrome.exe &#8211;user-data-dir=&#8221;<u><b>x:xxxx</b></u>&#8220;</p>\n<p>　　按照上述方式依样画葫芦，你就可以创建出任意多个 chrome 实例。为了省事，你可以把上述命令行做成一个快捷方式，放到桌面上，免得每次都敲键盘。</p>\n<h3>◇优点</h3>\n<p>　　<b>1. 解决跨站脚本（xss）的问题</b><br />　　这个优点跟&#8221;多浏览器&#8221;方案是类似的。俺就不再啰嗦了。</p>\n<p>　　<b>2. 部分解决高危插件（flash）的使用问题</b><br />　　这个优点跟&#8221;多浏览器&#8221;方案是类似的。俺就不再啰嗦了。</p>\n<p>　　<b>3. 灵活性高</b><br />　　跟&#8221;多浏览器&#8221;的方案相比，&#8221;多实例&#8221;的方案明显灵活多了。因为 firefox 和 chrome 可以创建出任意多个实例（只要你的硬盘够大，想建几个实例都行）。而且，这个方案可以满足某些 firefox 粉丝或 chrome 粉丝的个人偏好。</p>\n<h3>◇缺点</h3>\n<p>　　<b>1. 无法彻底解决浏览器漏洞的问题</b><br />　　在这方面，&#8221;多实例方案&#8221; 跟&#8221;多浏览器方案&#8221; 具有共同的缺陷——无法抵御具有本地代码执行的高危漏洞。包括浏览器漏洞和插件漏洞都有可能出现这类高危漏洞。<br />　　那么，该咋办捏，请看下一节——&#8221;多用户&#8221;的方案。</p>\n<h2>★&#8221;多用户&#8221;的方案</h2>\n<p>　　前面提到的两种方案，都无法防范某些浏览器或插件的高危漏洞。因为这些高危漏洞会导致在本地执行攻击代码，并有可能植入木马。现在，俺来介绍第三种方案——多用户方案。此方案可以防范<b>大部分</b>在本地执行的攻击代码。</p>\n<h3>◇某些高危漏洞为啥很危险？</h3>\n<p>　　俺前面反复提到&#8221;导致本地执行攻击代码的漏洞&#8221;。这样的漏洞是非常非常危险的。为啥捏？俺简单扫盲一下。<br />　　如果你的浏览器或者浏览器插件具有这类漏洞，当你访问某个恶意网页时，如果该恶意网页能够利用此漏洞，就可以在你的本地的操作系统中执行攻击代码。由于这个攻击代码是在浏览器的进程内触发的，所以该攻击代码就具有当前用户所具有的权限。<br />　　比方说，如今大部分网友都用 windows 上网。并且，这些网友都是以&#8221;系统管理员&#8221;的身份使用浏览器。一旦碰到这类漏洞时，本地的攻击代码也同时具有了&#8221;系统管理员权限&#8221;。有了这么高的权限，攻击代码可以为所欲为。<br />　　某些网友可能会问：那不用管理员身份上网，是不是就没事了？<br />　　俺只能说，用低权限的用户身份（比如 windows 里面的 users 组）上网，相对于用管理员身份上网，会好一些。但是捏，还是有问题。<br />　　举个例子：<br />　　即使你用低权限用户上网，一旦遭遇这类漏洞，攻击代码还是有可能植入木马。然后捏，这个木马有可能会查找你电脑上的各种私密文件（比如你的裸照）。然后木马会把这些私密文件发送给木马的主人。</p>\n<p>　　从上述例子可见，用低权限的用户上网，不能彻底解决问题。所以，俺隆重推出第三种方案——多用户方案。</p>\n<h3>◇什么是多用户方案？</h3>\n<p>　　如今的桌面操作系统，无论是 windows 还是 linux 或 mac os，都可以创建多个操作系统用户，并且这多个用户可以同时运行程序。如果你用过 winxp 的快速用户切换，应该对此深有体会。<br />　　多用户方案的关键在于：<br />　　你需要创建一个或多个<b>低权限</b>的&#8221;<b>上网用户</b>&#8220;（所谓低权限，必须低于你当前使用的用户权限）。这些&#8221;上网用户&#8221;专门用来访问各种网站。<br />　　假使你不幸访问了恶意网页，遭遇本地执行的攻击代码，问题也不大。因为这些上网用户的权限很低，所以它们触发的攻击代码，权限也很低。因此攻击代码就比较难钻空子。一般来说，对&#8221;上网用户&#8221;的权限限制得越严格，攻击代码就越难有作为。</p>\n<h3>◇操作步骤</h3>\n<p>　　<b>1. 创建上网用户</b><br />　　如何在桌面系统中创建新的用户，大家应该都会吧？不会的同学，请看《<a rel=\"nofollow\" href=\"http://program-think.blogspot.com/2010/06/howto-prevent-hacker-attack-1.html\">避免使用高权限用户</a>》一文的相关章节。上网用户可以只创建一个，也可以创建多个。具体建几个，看你的需求。<br />　　举例：<br />　　假如你非常看重网银的安全，可以创建两个上网用户，一个专门用来访问网银，一个专门用来上其它网站。<br />　　提醒一下：在这些上网用户的环境中，除了浏览器，其它啥软件都不需要装。</p>\n<p>　　<b>2. 设置上网用户的权限</b><br />　　再啰嗦一次，上网用户的权限，一定要低于你目前使用的用户权限。<br />　　以 windows 为例：<br />在 windows 中，常见的用户组的权限大小分别是： administrators 组 ＞ power users 组 ＞ users 组 ＞ guest 组。<br />如果你平时用&#8221;administrators 组&#8221;的用户，那么可以把上网用户设置为：power user 或 user 或 guest<br />如果你平时用&#8221;power users 组&#8221;的用户，那么上网用户就只能设置为 user 或 guest。<br />以此类推&#8230;&#8230;<br />（如果你想了解这些用户组之间的权限差异，可以参考本系列的第一个帖子《<a rel=\"nofollow\" href=\"http://program-think.blogspot.com/2010/06/howto-prevent-hacker-attack-1.html\">避免使用高权限用户</a>》）</p>\n<p>　　提醒一下：<br />　　guest 用户组的权限是最低，低得难以想象。所以，从安全角度而言，把上网用户设置为 guest 组是最安全的。但是，也是最麻烦的。你需要进行好多设置——否则的话，你可能连浏览器都跑不起来。<br />　　所以，除非你对 windows 系统比较熟悉，否则的话，俺不建议使用 guest 组的权限。比较理想的权限是 users 组。这个组的权限也比较低，但是用起来不麻烦。</p>\n<p>　　<b>3. 设置文件目录的访问控制权限（acl）</b><br />　　每个人的电脑中，都会有某几个目录是用来存放你的敏感个人资料的。<br />　　你必须设置这些目录的访问控制权限（简称 acl），设置为：&#8221;上网用户&#8221;所在的组<b>不能读写</b>。这样一来，你可以把自己那些敏感的，私密的文件（比如自己的裸照），都通过上述 acl 保护起来。即使&#8221;上网用户&#8221;遭遇高危漏洞的攻击，本地执行的攻击代码也<b>难以拿到</b>你的隐私（俺说&#8221;难以拿到&#8221;，意思就是说，还是有可能滴，但是可能性很小，后面会解释）。<br />　　顺便提醒一下：对于 windows 系统，只有使用 ntfs 格式的分区，才支持 acl。fat32 格式的分区是不支持滴！<br />　　如果你是个菜鸟，不懂得如何设置文件及目录的 acl，没关系！google 一下，你就知道。</p>\n<p>　　<b>4. 使用技巧</b><br />　　你可以直接用 windows 提供的&#8221;快速用户切换&#8221;。对于 windows 系统，从 winxp 开始就提供了快速用户切换功能。用它来切换用户还是很方便滴。但是这招有一个缺点：你一次只能看到某一个用户运行的软件，其它用户运行的软件看不到。<br />　　不过没关系，还有一个小技巧。<br />　　假设你建了 2 个用户 a 和 b。其中 a 是主用户，用来完成你日常的工作。b 是上网用户。那么，你可以先登录 a 用户，然后在 a 用户的桌面上，以 b 用户的身份启动浏览器。至于如何启动，请看《<a rel=\"nofollow\" href=\"http://program-think.blogspot.com/2010/06/howto-prevent-hacker-attack-1.html\">使用高权限用户</a>》一文的 &#8220;◇切换用户的麻烦&#8221; 这个小节。<br />　　对于习惯于命令行的 it 专业人员，可以用命令行的方式启动指定用户的某个进程。linux 系统和 mac os 系统有 su 命令；windows 系统有 runas 命令。</p>\n<h3>◇优点</h3>\n<p>　　<b>1. 解决跨站脚本（xss）的问题</b><br />　　这个优点跟前两种方案类似，俺就不再啰嗦了。</p>\n<p>　　<b>2. 解决高危插件（flash）的使用问题</b><br />　　这个优点跟前两种方案类似，俺就不再啰嗦了。</p>\n<p>　　<b>3. 防范各种浏览器漏洞</b><br />　　正如刚才提到的——前两种方案（多浏览器、多实例）无法防御浏览器及插件的某些高危漏洞（具备本地执行攻击代码的漏洞）。而&#8221;多用户方案&#8221;可以大大降低这类漏洞的危害性。使得攻击代码只能威胁到&#8221;上网用户&#8221;本身，而不会威胁到其它操作系统用户。</p>\n<h3>◇缺点</h3>\n<p>　　<b>1. 初始配置稍嫌麻烦</b><br />　　相比前面两种方案，这个方案的<b>初始配置</b>比较麻烦。而且你要分清楚哪个用户是用来干啥的。不过捏，一旦用久了，习惯了，也就不觉得麻烦了。</p>\n<p>　　<b>2. 无法防范极个别高明的攻击者</b><br />　　&#8221;多用户方案&#8221;之所以可以隔离攻击代码，是因为如今所有主流的桌面操作系统，都能够在操作系统层面，对不同的系统用户进行隔离。因为有操作系统层面的隔离，所以才限制了攻击代码的危害性。<br />　　但是，操作系统层面的隔离，也不是百分之百可靠滴。不要忘了，操作系统本身也是软件，也可能出现安全漏洞。在操作系统的安全漏洞中，有一类漏洞叫做&#8221;权限提升漏洞&#8221;（简称&#8221;提权漏洞&#8221;）。所谓的&#8221;提权漏洞&#8221;，顾名思义，就是能够提升<b>当前执行代码</b>的权限。比方说，本来攻击代码没有管理员权限，通过&#8221;提权漏洞&#8221;，就可以拿到管理员权限。<br />　　如果你的操作系统本身存在&#8221;提权漏洞&#8221;，同时你的浏览器或者插件存在&#8221;能够在本地执行代码的漏洞&#8221;，那么，高明的攻击者就有可能把这两者组合起来，对你的系统进行组合攻击。<br />　　不过大伙儿别担心——要实现这类组合攻击，需要同时掌握<b>未公开的</b>浏览器或插件漏洞，并且还要有<b>未公开的</b>操作系统提权漏洞（俺在<a rel=\"nofollow\" href=\"http://program-think.blogspot.com/2010/08/howto-prevent-hacker-attack-4.html\">前面的帖子</a>里介绍过，&#8221;未公开漏洞&#8221;比&#8221;零日漏洞&#8221;更危险）。另外，攻击者还需要做很多准备工作，才能诱使你访问到恶意网页。一般的入侵者根本没有这个本事，也没有耐心去搞这些。反之，有这个本事又有这个耐心的入侵者，根本不会拿这种招数去入侵普通网友（这么做简直是大材小用）。所以，如果你只是一个普通的网友，在前面三个方案中挑选一个，即可。</p>\n<p>　　估计有些好奇的同学会打听了。什么样的入侵者具有这种实力？什么样的人会成为他们的目标？<br />　　由于本文的篇幅已经很长了，俺稍微调一下列位看官的胃口，在《web相关的防范 (下)》再来八卦这些，同时也介绍一下比&#8221;多用户方案&#8221;更高级的第四种方案。虽然这种方案很多人用不到，但俺还是会写出来，就当满足一下大伙儿的好奇心 :-)</p>\n<p><a rel=\"nofollow\" href=\"http://program-think.blogspot.com/2010/06/howto-prevent-hacker-attack-0.html#index\">回到本系列的目录</a><img src=\"http://feeds.feedburner.com/~r/programthink/~4/qqykywrn9ea\" height=\"1\" width=\"1\" /></p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<form method=\"POST\" action=\"http://chinadigitaltimes.us4.list-manage.com/subscribe/post?u=17daa75df533f6c6ff72e51ab&#038;id=2ea93c5b7b\">\n<a href=\"http://eepurl.com/msuvD\">墙外新闻实时更新 欢迎订阅数字时代</a><br />\n <br /><input type=\"email\" value=\"\" name=\"EMAIL\" id=\"mce-EMAIL_in_post\" size=\"25\" style=\"display:block;\" placeholder=\"请输入您的邮件地址\" required><br />\n\t<input type=\"submit\" value=\"点击订阅\" name=\"subscribe\" style=\"height: 20px;\" id=\"in_post_subscribe\"><br />\n</form>\n","author":1004,"categories":[18270,18269,20534],"tags":[16910]}